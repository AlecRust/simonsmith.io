define("modules/Spinner",["require","zepto","mediator-js","prime"],function(e){var t=e("zepto"),n=e("mediator-js"),r=e("prime");return r({constructor:function(e,n){this.container=t(e),this.elem=t("<div></div>",{"class":"loading","aria-hidden":!0}).hide(),this.elem.appendTo(this.container),this.attachEvents(n)},attachEvents:function(e){n.subscribe(e.show,this.show,null,this),n.subscribe(e.hide,this.hide,null,this)},show:function(){this.elem.attr("aria-hidden",!1).show(),this.container.attr("aria-busy",!0)},hide:function(){this.elem.attr("aria-hidden",!0).hide(),this.container.attr("aria-busy",!1)}})}),define("modules/Scroller",["require","zepto","mediator-js","prime"],function(e){var t=e("zepto"),n=e("mediator-js"),r=e("prime");return r({constructor:function(e){this.attachEvents(e.contentLoad)},scrollable:t("html, body"),attachEvents:function(e){n.subscribe(e,this.scrollToTop,null,this)},scrollToTop:function(e){"ajax"==e.navType&&this.scrollable.animate({scrollTop:0})}})}),define("modules/PageUpdater",["require","zepto","handlebars","mediator-js","prime"],function(e){var t=e("zepto"),n=e("handlebars"),r=e("mediator-js"),i=e("prime");return i({constructor:function(e,n,r){this.nav=t(e),this.injectTarget=t(n),this.body=t(document.body),this.attachEvents(r.contentLoad)},attachEvents:function(e){r.subscribe(e,this.updatePage,null,this)},updatePage:function(e){var n=e.response;return n.page_meta.page_title==t.trim(document.title.split("|")[0])?(r.publish("content:rendered",n.page_meta),void 0):(this.updateNavigation(n.page_meta.nav_menu),this.updateBodyClass(n.page_meta.body_class),this.updateTitle(n.page_meta.page_title),e.navType||this.updateContent(e.href,n),"popstate"==e.navType&&this.renderTemplate(n.template,n),void 0)},updateTitle:function(e){var n=document.title.split("|");document.title=[e," | ",t.trim(n[1])].join("")},updateNavigation:function(e){this.nav.html(e)},updateBodyClass:function(e){this.body.removeClass().addClass(e)},updateContent:function(e,t){this.renderTemplate(t.template,t),history.pushState(t,null,e)},renderTemplate:function(e,t){var i=n.templates[e];this.injectTarget.html(i(t)),r.publish("content:rendered",t.page_meta)}})}),define("modules/PageController",["require","zepto","mediator-js","prime","modules/Spinner","modules/Scroller","modules/PageUpdater","modules/Storage"],function(e){var t=e("zepto"),n=e("mediator-js"),r=e("prime"),i=e("modules/Spinner"),s=e("modules/Scroller"),a=e("modules/PageUpdater"),o=e("modules/Storage");return r({constructor:function(e){t.each(e,function(e,n){this[e]=t(n)}.bind(this)),new i(this.container,{show:"content:get:before",hide:"content:get:always"}),new s({contentLoad:"content:get:done"}),new a(this.nav,this.injectTarget,{contentLoad:"content:get:done"}),this.attachEvents()},attachEvents:function(){this.container.on("click",this.links.selector,this.getPageContent.bind(this)),window.addEventListener("popstate",function(e){e.state&&n.publish("content:get:done",{response:e.state,navType:"popstate"})}.bind(this))},getPageContent:function(e){var t="string"==typeof e?e:e.currentTarget.href;this.fetchFromStorage(t)||this.fetchFromServer(t),e&&e.preventDefault()},fetchFromStorage:function(e){var t=o.getItem(e);return t?(n.publish("content:get:done",{response:t,href:e}),t):null},fetchFromServer:function(e){var r=t.ajax({data:{ajax:!0},dataType:"json",context:this,timeout:6e3,url:e,beforeSend:function(){n.publish("content:get:before")}});r.always(function(){n.publish("content:get:always")}),r.fail(function(){n.publish("content:get:fail")}),r.done(function(t){n.publish("content:get:done",{response:t,href:e}),o.setItem(e,t)})}})});